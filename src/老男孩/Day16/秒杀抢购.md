# 限流

- 和已有电商逻辑重度耦合
- 资源共享,缺乏隔离
- 服务缺乏限流和过载保护
- MySQL存在性能瓶颈
- 系统缺乏降级措施,不能及时恢复
- 对雪崩缺乏深刻的认识


秒杀2.0
- 代码和部署完全隔离,避免相互影响
- 根据后端承载能力,进行限流，防止全网挂掉
- 平台化,所有操作在web平台实时生效
- 使用Redis承载海量QPS
- 整个系统采用Go重新开发,极大地提高系统的性能

Redis 缓存/原子操作/队列


秒杀3.0
对秒杀系统进行拆分
- 系统解耦
- 过载保护
- 降级预案

                    web平台
                       |
                       |
           |------- 配置管理etcd-----------|
           |                              |
           |                              |
           |                              |
用户---->秒杀接入层----->Redis队列 ------> 秒杀逻辑层 -----> 抢到了?---->Y
                                <-----------抢购资格-----------------
                                                              ---->N
                                <-----------没抢到-------------------
   <-----


# 请求加入Redis 可以加个超时的时间戳 接入层这边可以达到过载保护


# 秒杀接入层核心功能
- 长连接
- url校验
- ip黑名单
- refer白名单
- 抢购开关
- Id黑名单


# 配置项
- etcd配置
- 超时时间
- 等待时间
- token密钥
- 前端延迟
- 是否验证uid

hdinfo
- 强制售罄
- 活动未开始
- 活动已结束
- 售罄
- 正常状态


获取参数
校验uid
校验商品
频率控制
活动判断
    - 活动未开始
    - 活动开始,未售罄
    - 活动开始,售罄
    - 活动已结束
过载保护
    - 秒级限流
    - 分钟级限流
    - 随机限流
    - vip用户不限流
发送给业务

/sec_info,用来获取当前商品的信息,比如活动开始的时间,活动结束的时间,该商品的状态
/sec_kill,秒杀接口。
